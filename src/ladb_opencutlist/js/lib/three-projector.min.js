!function(){class c{constructor(){this.id=0,this.object=null,this.z=0,this.renderOrder=0}}class R{constructor(){this.id=0,this.v1=new b,this.v2=new b,this.v3=new b,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0,this.renderOrder=0}}class b{constructor(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0}copy(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)}}class S{constructor(){this.id=0,this.v1=new b,this.v2=new b,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0,this.renderOrder=0}}class p{constructor(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null,this.renderOrder=0}}THREE.Projector=class{constructor(){let r,z,t=0,o,V,n=0,d,j,f=0,m,O,v=0,s,C,l=0,W;const A={objects:[],lights:[],elements:[]},x=new THREE.Vector3,L=new THREE.Vector4,E=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),y=new THREE.Box3,g=new Array(3),N=new THREE.Matrix4,P=new THREE.Matrix4,F=new THREE.Matrix4,I=new THREE.Frustum,i=[],w=[],M=[],T=[],a=[];const B=new function(){const s=[],l=[],a=[];let c=null;const p=new THREE.Matrix3;function i(e){var r=e.position,t=e.positionWorld,i=e.positionScreen,r=(t.copy(r).applyMatrix4(W),i.copy(t).applyMatrix4(P),1/i.w);i.x*=r,i.y*=r,i.z*=r,e.visible=-1<=i.x&&i.x<=1&&-1<=i.y&&i.y<=1&&-1<=i.z&&i.z<=1}function u(e,r,t){return!0===e.visible||!0===r.visible||!0===t.visible||(g[0]=e.positionScreen,g[1]=r.positionScreen,g[2]=t.positionScreen,E.intersectsBox(y.setFromPoints(g)))}function h(e,r,t){return(t.positionScreen.x-e.positionScreen.x)*(r.positionScreen.y-e.positionScreen.y)-(t.positionScreen.y-e.positionScreen.y)*(r.positionScreen.x-e.positionScreen.x)<0}return{setObject:function(e){c=e,p.getNormalMatrix(c.matrixWorld),s.length=0,l.length=0,a.length=0},projectVertex:i,checkTriangleVisibility:u,checkBackfaceCulling:h,pushVertex:function(e,r,t){(o=function(){if(V!==n)return w[V++];{var e=new b;return w.push(e),n++,V++,e}}()).position.set(e,r,t),i(o)},pushNormal:function(e,r,t){s.push(e,r,t)},pushColor:function(e,r,t){l.push(e,r,t)},pushUv:function(e,r){a.push(e,r)},pushLine:function(e,r){var t=w[e],i=w[r];t.positionScreen.copy(t.position).applyMatrix4(F),i.positionScreen.copy(i.position).applyMatrix4(F),!0===function(e,r){let t=0,i=1;var o=e.z+e.w,n=r.z+r.w,s=-e.z+e.w,l=-r.z+r.w;return 0<=o&&0<=n&&0<=s&&0<=l||!(o<0&&n<0||s<0&&l<0||(o<0?t=Math.max(t,o/(o-n)):n<0&&(i=Math.min(i,o/(o-n))),s<0?t=Math.max(t,s/(s-l)):l<0&&(i=Math.min(i,s/(s-l))),i<t)||(e.lerp(r,t),r.lerp(e,1-i),0))}(t.positionScreen,i.positionScreen)&&(t.positionScreen.multiplyScalar(1/t.positionScreen.w),i.positionScreen.multiplyScalar(1/i.positionScreen.w),(m=function(){if(O!==v)return T[O++];{var e=new S;return T.push(e),v++,O++,e}}()).id=c.id,m.v1.copy(t),m.v2.copy(i),m.z=Math.max(t.positionScreen.z,i.positionScreen.z),m.renderOrder=c.renderOrder,m.material=c.material,c.material.vertexColors&&(m.vertexColors[0].fromArray(l,3*e),m.vertexColors[1].fromArray(l,3*r)),A.elements.push(m))},pushTriangle:function(e,r,t,i){var o=w[e],r=w[r],t=w[t];if(!1!==u(o,r,t)&&(i.side===THREE.DoubleSide||!0===h(o,r,t))){(d=function(){if(j!==f)return M[j++];{var e=new R;return M.push(e),f++,j++,e}}()).id=c.id,d.v1.copy(o),d.v2.copy(r),d.v3.copy(t),d.z=(o.positionScreen.z+r.positionScreen.z+t.positionScreen.z)/3,d.renderOrder=c.renderOrder,x.subVectors(t.position,r.position),L.subVectors(o.position,r.position),x.cross(L),d.normalModel.copy(x),d.normalModel.applyMatrix3(p).normalize();for(let e=0;e<3;e++){var n=d.vertexNormalsModel[e];n.fromArray(s,3*arguments[e]),n.applyMatrix3(p).normalize(),d.uvs[e].fromArray(a,2*arguments[e])}d.vertexNormalsLength=3,(d.material=i).vertexColors&&d.color.fromArray(l,3*e),A.elements.push(d)}}}};function U(e){(r=function(){if(z!==t)return i[z++];{var e=new c;return i.push(e),t++,z++,e}}()).id=e.id,r.object=e,x.setFromMatrixPosition(e.matrixWorld),x.applyMatrix4(P),r.z=x.z,r.renderOrder=e.renderOrder,A.objects.push(r)}function k(e,r,t){var i=1/e.w;e.z*=i,-1<=e.z&&e.z<=1&&((s=function(){if(C!==l)return a[C++];{var e=new p;return a.push(e),l++,C++,e}}()).id=r.id,s.x=e.x*i,s.y=e.y*i,s.z=e.z,s.renderOrder=r.renderOrder,s.object=r,s.rotation=r.rotation,s.scale.x=r.scale.x*Math.abs(s.x-(e.x+t.projectionMatrix.elements[0])/(e.w+t.projectionMatrix.elements[12])),s.scale.y=r.scale.y*Math.abs(s.y-(e.y+t.projectionMatrix.elements[5])/(e.w+t.projectionMatrix.elements[13])),s.material=r.material,A.elements.push(s))}function X(e,r){return e.renderOrder!==r.renderOrder?e.renderOrder-r.renderOrder:e.z!==r.z?r.z-e.z:e.id!==r.id?e.id-r.id:0}this.projectScene=function(e,t,r,i){j=0,O=0,C=0,!(A.elements.length=0)===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),N.copy(t.matrixWorldInverse),P.multiplyMatrices(t.projectionMatrix,N),I.setFromProjectionMatrix(P),z=0,A.objects.length=0,A.lights.length=0,function t(e){if(!1!==e.visible){if(e.isLight)A.lights.push(e);else if(e.isMesh||e.isLine||e.isPoints){if(!1===e.material.visible)return;if(!0===e.frustumCulled&&!1===I.intersectsObject(e))return;U(e)}else if(e.isSprite){if(!1===e.material.visible)return;if(!0===e.frustumCulled&&!1===I.intersectsSprite(e))return;U(e)}var i=e.children;for(let e=0,r=i.length;e<r;e++)t(i[e])}}(e),!0===r&&A.objects.sort(X);var o=A.objects;for(let e=0,r=o.length;e<r;e++){var s=o[e].object,l=s.geometry;if(B.setObject(s),W=s.matrixWorld,V=0,s.isMesh){let t=s.material;var n=Array.isArray(t),a=l.attributes,c=l.groups;if(void 0!==a.position){var p=a.position.array;for(let n=0,e=p.length;n<e;n+=3){let t=p[n],i=p[n+1],o=p[n+2];var u=l.morphAttributes.position;if(void 0!==u){var h=l.morphTargetsRelative,d=s.morphTargetInfluences;for(let e=0,r=u.length;e<r;e++){var f,m=d[e];0!==m&&(f=u[e],h?(t+=f.getX(n/3)*m,i+=f.getY(n/3)*m,o+=f.getZ(n/3)*m):(t+=(f.getX(n/3)-p[n])*m,i+=(f.getY(n/3)-p[n+1])*m,o+=(f.getZ(n/3)-p[n+2])*m))}}B.pushVertex(t,i,o)}if(void 0!==a.normal){var v=a.normal.array;for(let e=0,r=v.length;e<r;e+=3)B.pushNormal(v[e],v[e+1],v[e+2])}if(void 0!==a.color){var x=a.color.array;for(let e=0,r=x.length;e<r;e+=3)B.pushColor(x[e],x[e+1],x[e+2])}if(void 0!==a.uv){var E=a.uv.array;for(let e=0,r=E.length;e<r;e+=2)B.pushUv(E[e],E[e+1])}if(null!==l.index){var y=l.index.array;if(0<c.length)for(let e=0;e<c.length;e++){var g=c[e];if(void 0!==(t=!0===n?s.material[g.materialIndex]:s.material))for(let e=g.start,r=g.start+g.count;e<r;e+=3)B.pushTriangle(y[e],y[e+1],y[e+2],t)}else for(let e=0,r=y.length;e<r;e+=3)B.pushTriangle(y[e],y[e+1],y[e+2],t)}else if(0<c.length)for(let e=0;e<c.length;e++){var w=c[e];if(void 0!==(t=!0===n?s.material[w.materialIndex]:s.material))for(let e=w.start,r=w.start+w.count;e<r;e+=3)B.pushTriangle(e,e+1,e+2,t)}else for(let e=0,r=p.length/3;e<r;e+=3)B.pushTriangle(e,e+1,e+2,t)}}else if(s.isLine){F.multiplyMatrices(P,W);a=l.attributes;if(void 0!==a.position){var M=a.position.array;for(let e=0,r=M.length;e<r;e+=3)B.pushVertex(M[e],M[e+1],M[e+2]);if(void 0!==a.color){var T=a.color.array;for(let e=0,r=T.length;e<r;e+=3)B.pushColor(T[e],T[e+1],T[e+2])}if(null!==l.index){var R=l.index.array;for(let e=0,r=R.length;e<r;e+=2)B.pushLine(R[e],R[e+1])}else{var b=s.isLineSegments?2:1;for(let e=0,r=M.length/3-1;e<r;e+=b)B.pushLine(e,e+1)}}}else if(s.isPoints){F.multiplyMatrices(P,W);var S=l.attributes;if(void 0!==S.position){var H=S.position.array;for(let e=0,r=H.length;e<r;e+=3)L.set(H[e],H[e+1],H[e+2],1),L.applyMatrix4(F),k(L,s,t)}}else s.isSprite&&(s.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,s.matrixWorld),L.set(W.elements[12],W.elements[13],W.elements[14],1),L.applyMatrix4(P),k(L,s,t))}return!0===i&&A.elements.sort(X),A}}},THREE.RenderableFace=R,THREE.RenderableLine=S,THREE.RenderableObject=c,THREE.RenderableSprite=p,THREE.RenderableVertex=b}();