!function(){const s=new THREE.Raycaster,a=new THREE.Vector3,r=new THREE.Vector3,h=new THREE.Quaternion,l={X:new THREE.Vector3(1,0,0),Y:new THREE.Vector3(0,1,0),Z:new THREE.Vector3(0,0,1)},m={type:"change"},e={type:"mouseDown"},i={type:"mouseUp",mode:null},c={type:"objectChange"};class t extends THREE.Object3D{constructor(t,e){super(),void 0===e&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),e=document),this.isTransformControls=!0,this.visible=!1,this.domElement=e,this.domElement.style.touchAction="none";const o=new I,n=(this._gizmo=o,this.add(o),new Q),s=(this._plane=n,this.add(n),this);function i(e,t){let i=t;Object.defineProperty(s,e,{get:function(){return void 0!==i?i:t},set:function(t){i!==t&&(i=t,n[e]=t,o[e]=t,s.dispatchEvent({type:e+"-changed",value:t}),s.dispatchEvent(m))}}),s[e]=t,n[e]=t,o[e]=t}i("camera",t),i("object",void 0),i("enabled",!0),i("axis",null),i("mode","translate"),i("translationSnap",null),i("rotationSnap",null),i("scaleSnap",null),i("space","world"),i("size",1),i("dragging",!1),i("showX",!0),i("showY",!0),i("showZ",!0);var e=new THREE.Vector3,t=new THREE.Vector3,a=new THREE.Quaternion,r=new THREE.Quaternion,h=new THREE.Vector3,l=new THREE.Quaternion,c=new THREE.Vector3,E=new THREE.Vector3,p=new THREE.Vector3,d=new THREE.Vector3;i("worldPosition",e),i("worldPositionStart",t),i("worldQuaternion",a),i("worldQuaternionStart",r),i("cameraPosition",h),i("cameraQuaternion",l),i("pointStart",c),i("pointEnd",E),i("rotationAxis",p),i("rotationAngle",0),i("eye",d),this._offset=new THREE.Vector3,this._startNorm=new THREE.Vector3,this._endNorm=new THREE.Vector3,this._cameraScale=new THREE.Vector3,this._parentPosition=new THREE.Vector3,this._parentQuaternion=new THREE.Quaternion,this._parentQuaternionInv=new THREE.Quaternion,this._parentScale=new THREE.Vector3,this._worldScaleStart=new THREE.Vector3,this._worldQuaternionInv=new THREE.Quaternion,this._worldScale=new THREE.Vector3,this._positionStart=new THREE.Vector3,this._quaternionStart=new THREE.Quaternion,this._scaleStart=new THREE.Vector3,this._getPointer=u.bind(this),this._onPointerDown=w.bind(this),this._onPointerHover=y.bind(this),this._onPointerMove=T.bind(this),this._onPointerUp=H.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(t){void 0!==this.object&&!0!==this.dragging&&(s.setFromCamera(t,this.camera),t=E(this._gizmo.picker[this.mode],s),this.axis=t?t.object.name:null)}pointerDown(t){void 0!==this.object&&!0!==this.dragging&&0===t.button&&null!==this.axis&&(s.setFromCamera(t,this.camera),(t=E(this._plane,s,!0))&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,e.mode=this.mode,this.dispatchEvent(e))}pointerMove(t){var e=this.axis,i=this.mode,o=this.object;let n=this.space;if("scale"===i?n="local":"E"!==e&&"XYZE"!==e&&"XYZ"!==e||(n="world"),void 0!==o&&null!==e&&!1!==this.dragging&&-1===t.button){s.setFromCamera(t,this.camera);var t=E(this._plane,s,!0);if(t){if(this.pointEnd.copy(t.point).sub(this.worldPositionStart),"translate"===i)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===n&&"XYZ"!==e&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===e.indexOf("X")&&(this._offset.x=0),-1===e.indexOf("Y")&&(this._offset.y=0),-1===e.indexOf("Z")&&(this._offset.z=0),("local"===n&&"XYZ"!==e?this._offset.applyQuaternion(this._quaternionStart):this._offset.applyQuaternion(this._parentQuaternionInv)).divide(this._parentScale),o.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===n&&(o.position.applyQuaternion(h.copy(this._quaternionStart).invert()),-1!==e.search("X")&&(o.position.x=Math.round(o.position.x/this.translationSnap)*this.translationSnap),-1!==e.search("Y")&&(o.position.y=Math.round(o.position.y/this.translationSnap)*this.translationSnap),-1!==e.search("Z")&&(o.position.z=Math.round(o.position.z/this.translationSnap)*this.translationSnap),o.position.applyQuaternion(this._quaternionStart)),"world"===n)&&(o.parent&&o.position.add(a.setFromMatrixPosition(o.parent.matrixWorld)),-1!==e.search("X")&&(o.position.x=Math.round(o.position.x/this.translationSnap)*this.translationSnap),-1!==e.search("Y")&&(o.position.y=Math.round(o.position.y/this.translationSnap)*this.translationSnap),-1!==e.search("Z")&&(o.position.z=Math.round(o.position.z/this.translationSnap)*this.translationSnap),o.parent)&&o.position.sub(a.setFromMatrixPosition(o.parent.matrixWorld));else if("scale"===i){if(-1!==e.search("XYZ")){let t=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(t*=-1),r.set(t,t,t)}else a.copy(this.pointStart),r.copy(this.pointEnd),a.applyQuaternion(this._worldQuaternionInv),r.applyQuaternion(this._worldQuaternionInv),r.divide(a),-1===e.search("X")&&(r.x=1),-1===e.search("Y")&&(r.y=1),-1===e.search("Z")&&(r.z=1);o.scale.copy(this._scaleStart).multiply(r),this.scaleSnap&&(-1!==e.search("X")&&(o.scale.x=Math.round(o.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==e.search("Y")&&(o.scale.y=Math.round(o.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==e.search("Z"))&&(o.scale.z=Math.round(o.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap)}else"rotate"===i&&(this._offset.copy(this.pointEnd).sub(this.pointStart),t=20/this.worldPosition.distanceTo(a.setFromMatrixPosition(this.camera.matrixWorld)),"E"===e?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):"XYZE"===e?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(a.copy(this.rotationAxis).cross(this.eye))*t):"X"!==e&&"Y"!==e&&"Z"!==e||(this.rotationAxis.copy(l[e]),a.copy(l[e]),"local"===n&&a.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(a.cross(this.eye).normalize())*t),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),("local"===n&&"E"!==e&&"XYZE"!==e?(o.quaternion.copy(this._quaternionStart),o.quaternion.multiply(h.setFromAxisAngle(this.rotationAxis,this.rotationAngle))):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),o.quaternion.copy(h.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),o.quaternion.multiply(this._quaternionStart))).normalize());this.dispatchEvent(m),this.dispatchEvent(c)}}}pointerUp(t){0===t.button&&(this.dragging&&null!==this.axis&&(i.mode=this.mode,this.dispatchEvent(i)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()})}attach(t){return this.object=t,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(m),this.dispatchEvent(c),this.pointStart.copy(this.pointEnd))}getRaycaster(){return s}getMode(){return this.mode}setMode(t){this.mode=t}setTranslationSnap(t){this.translationSnap=t}setRotationSnap(t){this.rotationSnap=t}setScaleSnap(t){this.scaleSnap=t}setSize(t){this.size=t}setSpace(t){this.space=t}}function u(t){var e;return this.domElement.ownerDocument.pointerLockElement?{x:0,y:0,button:t.button}:(e=this.domElement.getBoundingClientRect(),{x:(t.clientX-e.left)/e.width*2-1,y:-(t.clientY-e.top)/e.height*2+1,button:t.button})}function y(t){if(this.enabled)switch(t.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(t))}}function w(t){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(t.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(t)),this.pointerDown(this._getPointer(t)))}function T(t){this.enabled&&this.pointerMove(this._getPointer(t))}function H(t){this.enabled&&(this.domElement.releasePointerCapture(t.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(t)))}function E(t,e,i){var o=e.intersectObject(t,!0);for(let t=0;t<o.length;t++)if(o[t].object.visible||i)return o[t];return!1}const p=new THREE.Euler,d=new THREE.Vector3(0,1,0),R=new THREE.Vector3(0,0,0),M=new THREE.Matrix4,b=new THREE.Quaternion,v=new THREE.Quaternion,o=new THREE.Vector3,n=new THREE.Matrix4,x=new THREE.Vector3(1,0,0),P=new THREE.Vector3(0,1,0),g=new THREE.Vector3(0,0,1),S=new THREE.Vector3,_=new THREE.Vector3,f=new THREE.Vector3;class I extends THREE.Object3D{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";var t=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),e=new THREE.LineBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=t.clone(),e=(i.opacity=.15,e.clone()),o=(e.opacity=.5,t.clone()),n=(o.color.setHex(16711680),t.clone()),s=(n.color.setHex(65280),t.clone()),a=(s.color.setHex(255),t.clone()),r=(a.color.setHex(16711680),a.opacity=.5,t.clone()),h=(r.color.setHex(65280),r.opacity=.5,t.clone()),l=(h.color.setHex(255),h.opacity=.5,t.clone()),c=(l.opacity=.25,t.clone());c.color.setHex(16776960),c.opacity=.25;t.clone().color.setHex(16776960);var t=t.clone(),E=(t.color.setHex(7895160),new THREE.CylinderGeometry(0,.04,.1,12)),p=(E.translate(0,.05,0),new THREE.BoxGeometry(.08,.08,.08)),d=(p.translate(0,.04,0),new THREE.BufferGeometry),m=(d.setAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,0,0],3)),new THREE.CylinderGeometry(.0075,.0075,.5,3));function u(t,e){t=new THREE.TorusGeometry(t,.0075,3,64,e*Math.PI*2);return t.rotateY(Math.PI/2),t.rotateX(Math.PI/2),t}m.translate(0,.25,0);var E={X:[[new THREE.Mesh(E,o),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Mesh(E,o),[-.5,0,0],[0,0,Math.PI/2]],[new THREE.Mesh(m,o),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(E,n),[0,.5,0]],[new THREE.Mesh(E,n),[0,-.5,0],[Math.PI,0,0]],[new THREE.Mesh(m,n)]],Z:[[new THREE.Mesh(E,s),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Mesh(E,s),[0,0,-.5],[-Math.PI/2,0,0]],[new THREE.Mesh(m,s),null,[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),l.clone()),[0,0,0]]],XY:[[new THREE.Mesh(new THREE.BoxGeometry(.15,.15,.01),h.clone()),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.BoxGeometry(.15,.15,.01),a.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.BoxGeometry(.15,.15,.01),r.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},y={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,.6,4),i),[0,.3,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),i)]],XY:[[new THREE.Mesh(new THREE.BoxGeometry(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.BoxGeometry(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.BoxGeometry(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},w={START:[[new THREE.Mesh(new THREE.OctahedronGeometry(.01,2),e),null,null,null,"helper"]],END:[[new THREE.Mesh(new THREE.OctahedronGeometry(.01,2),e),null,null,null,"helper"]],DELTA:[[new THREE.Line(((w=new THREE.BufferGeometry).setAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,1,1],3)),w),e),null,null,null,"helper"]],X:[[new THREE.Line(d,e.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(d,e.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(d,e.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},t={XYZE:[[new THREE.Mesh(u(.5,1),t),null,[0,Math.PI/2,0]]],X:[[new THREE.Mesh(u(.5,.5),o)]],Y:[[new THREE.Mesh(u(.5,.5),n),null,[0,0,-Math.PI/2]]],Z:[[new THREE.Mesh(u(.5,.5),s),null,[0,Math.PI/2,0]]],E:[[new THREE.Mesh(u(.75,1),c),null,[0,Math.PI/2,0]]]},c={AXIS:[[new THREE.Line(d,e.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},T={XYZE:[[new THREE.Mesh(new THREE.SphereGeometry(.25,10,8),i)]],X:[[new THREE.Mesh(new THREE.TorusGeometry(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusGeometry(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusGeometry(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusGeometry(.75,.1,2,24),i)]]},o={X:[[new THREE.Mesh(p,o),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Mesh(m,o),[0,0,0],[0,0,-Math.PI/2]],[new THREE.Mesh(p,o),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new THREE.Mesh(p,n),[0,.5,0]],[new THREE.Mesh(m,n)],[new THREE.Mesh(p,n),[0,-.5,0],[0,0,Math.PI]]],Z:[[new THREE.Mesh(p,s),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Mesh(m,s),[0,0,0],[Math.PI/2,0,0]],[new THREE.Mesh(p,s),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new THREE.Mesh(new THREE.BoxGeometry(.15,.15,.01),h),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.BoxGeometry(.15,.15,.01),a),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.BoxGeometry(.15,.15,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.1,.1,.1),l.clone())]]},n={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,.6,4),i),[0,.3,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new THREE.Mesh(new THREE.BoxGeometry(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.BoxGeometry(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.BoxGeometry(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.2,.2,.2),i),[0,0,0]]]},m={X:[[new THREE.Line(d,e.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(d,e.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(d,e.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function H(e){var i=new THREE.Object3D;for(const h in e)for(let t=e[h].length;t--;){var o=e[h][t][0].clone(),n=e[h][t][1],s=e[h][t][2],a=e[h][t][3],r=e[h][t][4],r=(o.name=h,o.tag=r,n&&o.position.set(n[0],n[1],n[2]),s&&o.rotation.set(s[0],s[1],s[2]),a&&o.scale.set(a[0],a[1],a[2]),o.updateMatrix(),o.geometry.clone());r.applyMatrix4(o.matrix),o.geometry=r,o.renderOrder=1/0,o.position.set(0,0,0),o.rotation.set(0,0,0),o.scale.set(1,1,1),i.add(o)}return i}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=H(E)),this.add(this.gizmo.rotate=H(t)),this.add(this.gizmo.scale=H(o)),this.add(this.picker.translate=H(y)),this.add(this.picker.rotate=H(T)),this.add(this.picker.scale=H(n)),this.add(this.helper.translate=H(w)),this.add(this.helper.rotate=H(c)),this.add(this.helper.scale=H(m)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(t){var i="local"===("scale"===this.mode?"local":this.space)?this.worldQuaternion:v;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let o=[];o=(o=(o=o.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(let e=0;e<o.length;e++){const n=o[e];n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition);let t;t=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(t*this.size/4),"helper"===n.tag?(n.visible=!1,"AXIS"===n.name?(n.position.copy(this.worldPositionStart),n.visible=!!this.axis,"X"===this.axis&&(h.setFromEuler(p.set(0,0,0)),n.quaternion.copy(i).multiply(h),.9<Math.abs(d.copy(x).applyQuaternion(i).dot(this.eye)))&&(n.visible=!1),"Y"===this.axis&&(h.setFromEuler(p.set(0,0,Math.PI/2)),n.quaternion.copy(i).multiply(h),.9<Math.abs(d.copy(P).applyQuaternion(i).dot(this.eye)))&&(n.visible=!1),"Z"===this.axis&&(h.setFromEuler(p.set(0,Math.PI/2,0)),n.quaternion.copy(i).multiply(h),.9<Math.abs(d.copy(g).applyQuaternion(i).dot(this.eye)))&&(n.visible=!1),"XYZE"===this.axis&&(h.setFromEuler(p.set(0,Math.PI/2,0)),d.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(M.lookAt(R,d,P)),n.quaternion.multiply(h),n.visible=this.dragging),"E"===this.axis&&(n.visible=!1)):"START"===n.name?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):"END"===n.name?(n.position.copy(this.worldPosition),n.visible=this.dragging):"DELTA"===n.name?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),a.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),a.applyQuaternion(this.worldQuaternionStart.clone().invert()),n.scale.copy(a),n.visible=this.dragging):(n.quaternion.copy(i),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=-1!==this.axis.search(n.name)))):(n.quaternion.copy(i),"translate"===this.mode||"scale"===this.mode?("X"===n.name&&.99<Math.abs(d.copy(x).applyQuaternion(i).dot(this.eye))&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Y"===n.name&&.99<Math.abs(d.copy(P).applyQuaternion(i).dot(this.eye))&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Z"===n.name&&.99<Math.abs(d.copy(g).applyQuaternion(i).dot(this.eye))&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XY"===n.name&&Math.abs(d.copy(g).applyQuaternion(i).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"YZ"===n.name&&Math.abs(d.copy(x).applyQuaternion(i).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XZ"===n.name&&Math.abs(d.copy(P).applyQuaternion(i).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1)):"rotate"===this.mode&&(b.copy(i),d.copy(this.eye).applyQuaternion(h.copy(i).invert()),-1!==n.name.search("E")&&n.quaternion.setFromRotationMatrix(M.lookAt(this.eye,R,P)),"X"===n.name&&(h.setFromAxisAngle(x,Math.atan2(-d.y,d.z)),h.multiplyQuaternions(b,h),n.quaternion.copy(h)),"Y"===n.name&&(h.setFromAxisAngle(P,Math.atan2(d.x,d.z)),h.multiplyQuaternions(b,h),n.quaternion.copy(h)),"Z"===n.name)&&(h.setFromAxisAngle(g,Math.atan2(d.y,d.x)),h.multiplyQuaternions(b,h),n.quaternion.copy(h)),n.visible=n.visible&&(-1===n.name.indexOf("X")||this.showX),n.visible=n.visible&&(-1===n.name.indexOf("Y")||this.showY),n.visible=n.visible&&(-1===n.name.indexOf("Z")||this.showZ),n.visible=n.visible&&(-1===n.name.indexOf("E")||this.showX&&this.showY&&this.showZ),n.material._color=n.material._color||n.material.color.clone(),n.material._opacity=n.material._opacity||n.material.opacity,n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled&&this.axis&&(n.name===this.axis||this.axis.split("").some(function(t){return n.name===t}))&&(n.material.color.setHex(16776960),n.material.opacity=1))}super.updateMatrixWorld(t)}}class Q extends THREE.Mesh{constructor(){super(new THREE.PlaneGeometry(1e5,1e5,2,2),new THREE.MeshBasicMaterial({visible:!1,wireframe:!0,side:THREE.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(t){let e=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(e="local"),S.copy(x).applyQuaternion("local"===e?this.worldQuaternion:v),_.copy(P).applyQuaternion("local"===e?this.worldQuaternion:v),f.copy(g).applyQuaternion("local"===e?this.worldQuaternion:v),d.copy(_),this.mode){case"translate":case"scale":switch(this.axis){case"X":d.copy(this.eye).cross(S),o.copy(S).cross(d);break;case"Y":d.copy(this.eye).cross(_),o.copy(_).cross(d);break;case"Z":d.copy(this.eye).cross(f),o.copy(f).cross(d);break;case"XY":o.copy(f);break;case"YZ":o.copy(S);break;case"XZ":d.copy(f),o.copy(_);break;case"XYZ":case"E":o.set(0,0,0)}break;default:o.set(0,0,0)}0===o.length()?this.quaternion.copy(this.cameraQuaternion):(n.lookAt(a.set(0,0,0),o,d),this.quaternion.setFromRotationMatrix(n)),super.updateMatrixWorld(t)}}THREE.TransformControls=t,THREE.TransformControlsGizmo=I,THREE.TransformControlsPlane=Q}();